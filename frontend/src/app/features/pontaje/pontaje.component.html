<!-- src/app/pontaje/pontaje.component.html -->
<div class="container mx-auto p-4 max-w-screen-xl">
  <h1 class="text-2xl font-bold mb-6 text-gray-800">Pontaje</h1>
  
  <div class="bg-white rounded-lg shadow-md mb-6">
    <div class="bg-gray-50 p-4 border-b border-gray-200">
      <h5 class="text-lg font-medium text-gray-700">Perioadă</h5>
    </div>
    <div class="p-4">
      <form [formGroup]="dataForm" (ngSubmit)="onDateChange()">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
          <div class="md:col-span-5">
            <label for="dataInceput" class="block text-sm font-medium text-gray-700 mb-1">Data început</label>
            <p-datePicker 
              id="dataInceput" 
              formControlName="dataInceput"
              [showIcon]="true"
              dateFormat="dd.mm.yy"
              styleClass="w-full"
              inputStyleClass="w-full p-inputtext">
            </p-datePicker>
          </div>
          <div class="md:col-span-5">
            <label for="dataSfarsit" class="block text-sm font-medium text-gray-700 mb-1">Data sfârșit</label>
            <p-datePicker 
              id="dataSfarsit" 
              formControlName="dataSfarsit"
              [showIcon]="true"
              dateFormat="dd.mm.yy"
              styleClass="w-full"
              inputStyleClass="w-full p-inputtext">
            </p-datePicker>
          </div>
          <div class="md:col-span-2 flex items-end">
            <p-button 
              type="submit" 
              label="Afișează" 
              icon="pi pi-search" 
              styleClass="w-full"
              [loading]="loading">
            </p-button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-md mb-6">
    <div class="bg-gray-50 p-4 border-b border-gray-200">
      <h5 class="text-lg font-medium text-gray-700">Acțiuni</h5>
    </div>
    <div class="p-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="card h-100">
          <div class="card-header bg-light">
            <h6 class="text-base font-medium text-gray-700">Generare normă de bază</h6>
          </div>
          <div class="p-4">
            <p class="text-sm text-gray-600 mb-4">Generează automat norma de bază (9:00-17:00) pentru zilele lucrătoare din luna selectată.</p>
            <div class="mb-3">
              <label for="lunaSelectata1" class="block text-sm font-medium text-gray-700 mb-1">Selectează luna</label>
              <p-datePicker 
                id="lunaSelectata1" 
                [(ngModel)]="lunaSelectata" 
                view="month" 
                dateFormat="MM.yy" 
                [showIcon]="true"
                [readonlyInput]="true" 
                styleClass="w-full">
              </p-datePicker>
            </div>
            <p-button 
              label="Generare normă" 
              icon="pi pi-calendar-plus" 
              styleClass="p-button-success"
              [loading]="loading"
              (onClick)="generareNormaBaza()">
            </p-button>
          </div>
        </div>
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
          <div class="bg-gray-50 p-3 border-b border-gray-200">
            <h6 class="text-base font-medium text-gray-700">Alocare proiect</h6>
          </div>
          <div class="p-4">
            <form [formGroup]="proiecteForm" (ngSubmit)="generarePontajeProiect()">
              <div class="mb-3">
                <label for="numeProiect" class="block text-sm font-medium text-gray-700 mb-1">Nume proiect</label>
                <p-autoComplete
                  id="numeProiect"
                  formControlName="numeProiect"
                  [suggestions]="proiecte"
                  [dropdown]="true"
                  styleClass="w-full"
                  placeholder="Introduceți sau selectați un proiect">
                </p-autoComplete>
              </div>
              <div class="mb-3">
                <label for="oreAlocate" class="block text-sm font-medium text-gray-700 mb-1">Ore de alocat</label>
                <p-inputNumber
                  id="oreAlocate"
                  formControlName="oreAlocate"
                  [min]="1"
                  [showButtons]="true"
                  styleClass="w-full">
                </p-inputNumber>
                <small class="text-xs text-gray-500 mt-1 block">Sistemul va căuta automat intervale libere și va aloca orele în perioada selectată</small>
              </div>
              <p-button 
                type="submit" 
                label="Previzualizare și alocare" 
                icon="pi pi-plus" 
                [disabled]="proiecteForm.invalid"
                [loading]="loading">
              </p-button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-md">
    <div class="bg-gray-50 p-4 border-b border-gray-200 flex justify-between items-center">
      <h5 class="text-lg font-medium text-gray-700">Lista pontajelor</h5>
      <p-badge [value]="pontaje.length.toString()" severity="info" styleClass="p-badge-info"></p-badge>
    </div>
    <div class="p-4">
      <div *ngIf="loading" class="flex flex-col items-center justify-center py-8">
        <p-progressSpinner styleClass="w-12 h-12"></p-progressSpinner>
        <p class="mt-3 text-gray-600">Se încarcă datele...</p>
      </div>
      
      <p-message *ngIf="!loading && pontaje.length === 0" severity="info" text="Nu există pontaje în perioada selectată." styleClass="w-full"></p-message>
      
      <p-table 
        *ngIf="!loading && pontaje.length > 0"
        [value]="pontaje"
        styleClass="p-datatable-sm"
        [rowHover]="true"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Afișare {first} - {last} din {totalRecords} pontaje"
        [rowsPerPageOptions]="[10, 25, 50]">
        
        <ng-template pTemplate="header">
          <tr>
            <th>Data</th>
            <th>Interval</th>
            <th>Durată</th>
            <th>Proiect</th>
            <th style="width: 10%">Acțiuni</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-pontaj>
          <tr [ngClass]="{'bg-green-50': pontaj.normaBaza}">
            <td>{{ pontaj.data | date:'dd.MM.yyyy' }}</td>
            <td>{{ formatTime(pontaj.oraStart) }} - {{ formatTime(pontaj.oraFinal) }}</td>
            <td>{{ calculateDuration(pontaj.oraStart, pontaj.oraFinal) }}</td>
            <td>{{ pontaj.numeProiect }}</td>
            <td>
              <p-button 
                label="Șterge"
                severity="danger" 
                size="small"
                (onClick)="deletePontaj(pontaj.id)"
                pTooltip="Șterge pontaj">
              </p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <app-pontaje-preview-dialog
    [(visible)]="showPreviewDialog"
    [pontajePreview]="pontajePreview"
    [numeProiect]="proiecteForm.get('numeProiect')?.value || ''"
    [loading]="previewLoading"
    [submitting]="submitting"
    (confirm)="onConfirmGenerarePontaje()"
    (cancel)="onCancelGenerarePontaje()">
  </app-pontaje-preview-dialog>
</div>